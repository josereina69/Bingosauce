<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BINGO SAUCE - Elite Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root { --sauce-red: #d32f2f; --sauce-orange: #ff6f00; --dark: #0e0e0e; --paper: #fff9c4; }
        body { font-family: 'Arial Black', sans-serif; background: var(--dark); color: #fff; margin: 0; padding: 10px; }
        
        /* --- PANEL PRINCIPAL BINGO SAUCE --- */
        .header-sauce { color: var(--sauce-orange); text-shadow: 3px 3px 0px var(--sauce-red); font-size: 3.5rem; margin: 10px 0; letter-spacing: -2px; text-align: center; }
        .big-ball { 
            width: 160px; height: 160px; background: radial-gradient(circle at 30% 30%, #fff, var(--sauce-orange)); 
            border-radius: 50%; display: flex; align-items: center; justify-content: center; 
            font-size: 6rem; color: #333; margin: 20px auto; border: 6px solid white; box-shadow: 0 0 40px var(--sauce-red);
        }
        .stats { color: var(--sauce-orange); font-size: 1.2rem; margin-bottom: 10px; text-align: center; }
        .grid-master { display: grid; grid-template-columns: repeat(10, 1fr); gap: 5px; max-width: 850px; margin: auto; background: #1a1a1a; padding: 15px; border-radius: 10px; }
        .n-off { background: #333; color: #555; padding: 8px; border-radius: 5px; font-size: 0.9rem; text-align: center; }
        .n-on { background: var(--sauce-red); color: white; font-weight: bold; box-shadow: 0 0 15px var(--sauce-red); border: 1px solid white; }

        /* CONTROLES */
        .controls-panel { background: #222; padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #444; text-align: center; }
        .speed-control { margin-top: 15px; font-family: sans-serif; color: var(--sauce-orange); font-weight: bold; }
        select { background: #444; color: white; border: 1px solid var(--sauce-orange); padding: 8px; border-radius: 5px; cursor: pointer; }

        /* --- VISTA JUGADOR --- */
        #pantalla-jugador { display: none; text-align: center; }
        .carton-real { 
            background: var(--paper); padding: 10px; border-radius: 4px; margin: 0 auto 25px auto;
            border: 3px solid #444; box-shadow: 8px 8px 0px #000; max-width: 480px;
        }
        .c-grid { display: grid; grid-template-columns: repeat(9, 1fr); gap: 2px; background: #444; }
        .c-celda { background: white; aspect-ratio: 1/1; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; color: #1a237e; font-weight: bold; position: relative; cursor: pointer; }
        .c-celda.vacia { background: #e0e0e0; }
        .marcado::after { content: '✖'; position: absolute; color: var(--sauce-red); font-size: 2.2rem; opacity: 0.8; }

        .btn-sauce { background: var(--sauce-red); border: none; padding: 15px 30px; color: white; font-weight: bold; border-radius: 50px; cursor: pointer; border-bottom: 5px solid #8b0000; margin: 5px; transition: 0.2s; }
        .btn-sauce:disabled { background: #444; border-bottom-color: #222; opacity: 0.6; cursor: not-allowed; }
        
        /* BOTONES JUGADOR */
        .player-actions { display: flex; flex-direction: column; gap: 10px; max-width: 480px; margin: auto; }
        .btn-linea { background: #2980b9; font-size: 1.8rem; padding: 15px; border-bottom-color: #1a5276; }
        .btn-bingo { background: var(--sauce-orange); font-size: 2.5rem; padding: 20px; border-bottom-color: #b34e00; }
        
        #qrcode { background: white; padding: 15px; display: inline-block; margin: 25px; border-radius: 15px; border: 5px solid var(--sauce-orange); }
        
        .overlay-alerta { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(211, 47, 47, 0.95); z-index: 1000; align-items: center; justify-content: center; flex-direction: column; font-size: 4rem; text-align: center; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0; } }
        .blink { animation: blink 0.4s infinite; }
    </style>
</head>
<body onclick="activarAudio()">

    <div id="alerta-bingo" class="overlay-alerta">
        <div class="blink" id="alerta-texto">¡¡BINGO SAUCE!!</div>
        <button class="btn-sauce" onclick="cerrarAlerta()" style="font-size: 1.5rem; margin-top: 20px;">CONTINUAR JUEGO</button>
    </div>

    <div id="panel-cantante">
        <h1 class="header-sauce">BINGO SAUCE</h1>
        <div class="controls-panel">
            <div class="stats">BOLAS RESTANTES: <span id="restantes">90</span></div>
            <div class="big-ball" id="bola">--</div>
            <button class="btn-sauce" id="btn-play" onclick="autoPlay()">INICIAR</button>
            <button class="btn-sauce" id="btn-pause" onclick="pausar()" style="background:#f39c12; border-bottom-color:#b34e00;">PAUSA</button>
            <button class="btn-sauce" onclick="reiniciarTodo()" style="background:#444; border-bottom-color:#222;">REINICIAR</button>
            
            <div class="speed-control">
                RITMO DE LA SALSA: 
                <select id="select-velocidad" onchange="cambiarVelocidad()">
                    <option value="8000">TORTUGA (8s)</option>
                    <option value="4000" selected>NORMAL (4s)</option>
                    <option value="2500">RÁPIDO (2.5s)</option>
                    <option value="1500">¡FLASH! (1.5s)</option>
                </select>
            </div>
        </div>
        <div class="grid-master" id="tablero"></div>
        <div style="text-align: center;">
            <div id="qrcode"></div>
        </div>
    </div>

    <div id="pantalla-jugador">
        <h1 class="header-sauce" style="font-size: 2rem;">BINGO SAUCE</h1>
        <div id="selector">
            <button class="btn-sauce" onclick="jugar(1)">1 CARTÓN</button>
            <button class="btn-sauce" onclick="jugar(2)">2 CARTONES</button>
            <button class="btn-sauce" onclick="jugar(3)">3 CARTONES</button>
        </div>
        <div id="zona-cartones" style="display:none;">
            <div id="mis-cartones"></div>
            <div class="player-actions">
                <button class="btn-sauce btn-linea" onclick="gritarPremio('LÍNEA')">¡LÍNEA!</button>
                <button class="btn-sauce btn-bingo" onclick="gritarPremio('BINGO')">¡BINGO!</button>
            </div>
        </div>
    </div>

    <script>
        const url = new URLSearchParams(window.location.search);
        let sacados = [];
        let timer = null;
        let audioIniciado = false;
        let msVelocidad = 4000;
        let juegoEnMarcha = false;

        function hablar(texto) {
            window.speechSynthesis.cancel();
            const msg = new SpeechSynthesisUtterance(texto);
            msg.lang = 'es-ES';
            window.speechSynthesis.speak(msg);
        }

        function activarAudio() { if (!audioIniciado) { hablar("Bienvenidos al Bingo Sauce."); audioIniciado = true; } }

        function crearTablero() {
            const t = document.getElementById('tablero');
            t.innerHTML = '';
            for(let i=1; i<=90; i++) {
                let d = document.createElement('div');
                d.className = 'n-off'; d.id = 'n-'+i; d.innerText = i;
                t.appendChild(d);
            }
        }

        if (url.has('play')) {
            document.getElementById('panel-cantante').style.display = 'none';
            document.getElementById('pantalla-jugador').style.display = 'block';
        } else {
            crearTablero();
            new QRCode(document.getElementById("qrcode"), { text: window.location.href + "?play=true", width: 160, height: 160 });
        }

        function sortear() {
            if (sacados.length >= 90) { pausar(); hablar("Tómbola vacía"); return; }
            let n;
            do { n = Math.floor(Math.random() * 90) + 1; } while (sacados.includes(n));
            sacados.push(n);
            document.getElementById('bola').innerText = n;
            document.getElementById('restantes').innerText = 90 - sacados.length;
            document.getElementById('n-'+n).className = 'n-off n-on';
            hablar(n);
        }

        function autoPlay() {
            if (juegoEnMarcha) return;
            juegoEnMarcha = true;
            document.getElementById('btn-play').disabled = true;
            sortear();
            timer = setInterval(sortear, msVelocidad);
        }

        function pausar() {
            clearInterval(timer);
            timer = null;
            juegoEnMarcha = false;
            document.getElementById('btn-play').disabled = false;
            window.speechSynthesis.cancel();
        }

        function reiniciarTodo() {
            if(confirm("¿Reiniciar BINGO SAUCE?")) {
                pausar(); sacados = [];
                document.getElementById('bola').innerText = '--';
                document.getElementById('restantes').innerText = '90';
                crearTablero();
            }
        }

        function cambiarVelocidad() {
            msVelocidad = parseInt(document.getElementById('select-velocidad').value);
            if(juegoEnMarcha) { clearInterval(timer); timer = setInterval(sortear, msVelocidad); }
        }

        function gritarPremio(tipo) {
            const alerta = document.getElementById('alerta-bingo');
            const texto = document.getElementById('alerta-texto');
            texto.innerText = `¡¡${tipo} SAUCE!!`;
            alerta.style.display = 'flex';
            hablar(`Atención, alguien ha cantado ${tipo}`);
            // Pausa el juego en el dispositivo del jugador
            pausar();
        }

        function cerrarAlerta() {
            document.getElementById('alerta-bingo').style.display = 'none';
        }

        // GENERACIÓN DE CARTONES
        function jugar(cant) {
            document.getElementById('selector').style.display = 'none';
            document.getElementById('zona-cartones').style.display = 'block';
            for(let i=0; i<cant; i++) {
                const wrapper = document.createElement('div');
                wrapper.className = 'carton-real';
                wrapper.innerHTML = `<div style="color:#333; font-size:0.7rem; display:flex; justify-content:space-between"><span>SAUCE PREMIUM</span><span>#${Math.floor(Math.random()*999)}</span></div>`;
                const grid = document.createElement('div'); grid.className = 'c-grid';
                let matriz = Array(3).fill().map(() => Array(9).fill(0));
                for(let f=0; f<3; f++) {
                    let cs = []; while(cs.length < 5) { let r = Math.floor(Math.random()*9); if(!cs.includes(r)) cs.push(r); }
                    cs.forEach(c => {
                        let num; do { num = Math.floor(Math.random()*10) + (c*10); if(num===0) num=1; if(num>90) num=90; } while(matriz.flat().includes(num));
                        matriz[f][c] = num;
                    });
                }
                for(let f=0; f<3; f++) {
                    for(let c=0; c<9; c++) {
                        let celda = document.createElement('div');
                        celda.className = 'c-celda' + (matriz[f][c] === 0 ? ' vacia' : '');
                        celda.innerText = matriz[f][c] || '';
                        if(matriz[f][c] !== 0) celda.onclick = function() { this.classList.toggle('marcado'); };
                        grid.appendChild(celda);
                    }
                }
                wrapper.appendChild(grid);
                document.getElementById('mis-cartones').appendChild(wrapper);
            }
        }
    </script>
</body>
</html>
